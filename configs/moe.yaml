# --- Model Architecture ---
img_size: 128
patch_size: 4
embed_dim: 128
text_dim: 768
num_experts: 4
top_k: 2
fno_modes: 16
swin_window_size: 8
swin_num_heads: 4
mlp_ratio: 4.0
max_num_channels: 256

# --- Loss & Optimization ---
aux_loss_weight: 0.01
loss_type: "mse"
lr_embedding_recovery: 1.0e-3

# --- Data Arguments ---
dataset_name: [
  "fluids.incompressible.Gaussians", 
  "fluids.incompressible.Sines", 
  "fluids.compressible.Riemann",
  "fluids.compressible.RiemannCurved",
  "fluids.compressible.KelvinHelmholtz",
  "fluids.compressible.Gaussians"
] 
data_path: "/data1/cenjianhuan/UniPDESolver/datasets/"       
max_train_samples: null
max_eval_samples: null
ar_steps: 1

# --- Training Arguments ---
output_dir: "./checkpoints/moe_run_final"
overwrite_output_dir: false     # 【关键修改】设为 false 以支持断点续训
do_train: true
do_eval: true

# Optimization
learning_rate: 5.0e-4
optim: "adamw_torch"
weight_decay: 1.0e-4
lr_scheduler_type: "cosine"
warmup_ratio: 0.05
num_train_epochs: 50

# Batch Size & Performance
per_device_train_batch_size: 128
per_device_eval_batch_size: 128
gradient_accumulation_steps: 1
fp16: false
bf16: false

# Logging & Saving
logging_steps: 50

# 【关键修改】策略调整为 epoch，且只保留最新的1个 + 最优的1个
evaluation_strategy: "epoch"
save_strategy: "epoch"
save_total_limit: 1             # 只保留1个最新的 checkpoint
load_best_model_at_end: true    # 训练结束加载最优模型（并确保最优chkpt不被删除）
metric_for_best_model: "eval_loss" # 根据 loss 选最优
greater_is_better: false        # loss 越小越好

# System
seed: 42
dataloader_num_workers: 4
remove_unused_columns: false